<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessibilit√© Totale : Zoom + Audio</title>
    <style>
        /* --- 1. CONFIGURATION --- */
        :root {
            --zoom-level: 2;         /* Puissance du zoom */
            --loupe-size: 300px;     /* Taille du rond */
            --bg-color: #1a1a1a;     /* Fond sombre */
            --text-color: #ffffff;   /* Texte blanc */
            --accent-color: #ffff00; /* Jaune accessible (AAA) */
        }

        /* On cache le curseur de base */
        * {
            cursor: none !important; 
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Verdana', sans-serif; /* Police tr√®s lisible */
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        /* --- 2. CONTENU DU SITE --- */
        #site-wrapper {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px;
            min-height: 100vh;
            background: #252525;
            position: relative;
        }

        header {
            border-bottom: 3px solid var(--accent-color);
            padding-bottom: 20px;
            margin-bottom: 40px;
        }

        h1 {
            color: var(--accent-color);
            font-size: 3.5rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        h2 {
            color: var(--accent-color);
            font-size: 2rem;
            border-left: 5px solid #fff;
            padding-left: 15px;
            margin-top: 40px;
        }

        p {
            font-size: 1.6rem;
            line-height: 1.8;
            margin-bottom: 25px;
            text-align: left;
        }

        /* √âl√©ments interactifs */
        .btn {
            display: inline-block;
            background-color: var(--accent-color);
            color: #000;
            font-weight: bold;
            font-size: 1.5rem;
            padding: 20px 40px;
            border-radius: 50px;
            border: none;
            margin-top: 20px;
            text-decoration: none;
            text-transform: uppercase;
        }

        .highlight-box {
            background: #333;
            border: 2px solid #fff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        /* --- 3. LA LOUPE (VISUEL) --- */
        #loupe-container {
            position: fixed;
            top: 0; 
            left: 0;
            width: var(--loupe-size);
            height: var(--loupe-size);
            border-radius: 50%;
            border: 5px solid #fff;
            /* Ombre port√©e forte pour bien d√©tacher la loupe */
            box-shadow: 0 0 40px rgba(0,0,0,0.9), inset 0 0 20px rgba(0,0,0,0.5);
            overflow: hidden; 
            z-index: 9999;
            pointer-events: none; /* Clics traversants */
            display: none; /* Masqu√© tant que la souris ne bouge pas */
            background: var(--bg-color); 
        }

        /* Le clone du site √† l'int√©rieur */
        #loupe-clone {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            transform-origin: 0 0;
            /* On s'assure que le fond du clone est opaque */
            background-color: var(--bg-color); 
        }
        
        /* Indicateur Audio visuel (petit ic√¥ne dans la loupe) */
        #audio-icon {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            color: lime;
            text-shadow: 0 0 5px #000;
            opacity: 0; /* Appara√Æt quand √ßa parle */
            transition: opacity 0.2s;
            z-index: 10000;
        }

    </style>
</head>
<body>

    <div id="site-wrapper">
        <header>
            <h1>Accessi-Vision</h1>
            <p>Technologie d'assistance combin√©e.</p>
        </header>

        <main>
            <p>Bienvenue. D√©placez votre souris sur la page. Non seulement le texte sera agrandi via la loupe optique, mais une voix de synth√®se vous lira le contenu survol√©.</p>

            <div class="highlight-box">
                <h2>Comment √ßa marche ?</h2>
                <p>Le syst√®me d√©tecte l'√©l√©ment sous le centre de la loupe. Si c'est du texte, il active la synth√®se vocale du navigateur.</p>
            </div>

            <p>Essayez de survoler les boutons ci-dessous pour entendre leur fonction.</p>
            
            <button class="btn">Valider le formulaire</button>
            <br><br>
            <button class="btn" style="background-color:#fff; color:#000;">Annuler l'action</button>
            
            <h2>Confidentialit√©</h2>
            <p>Tout se passe localement sur votre navigateur. Aucune donn√©e n'est envoy√©e vers un serveur externe.</p>
        </main>
    </div>

    <div id="loupe-container">
        <div id="loupe-clone"></div>
        <div id="audio-icon">üîä Lecture...</div>
    </div>

    <script>
        // --- VARIABLES ---
        const ZOOM_LEVEL = 2;
        const LOUPE_SIZE = 300;
        const siteWrapper = document.getElementById('site-wrapper');
        const loupeContainer = document.getElementById('loupe-container');
        const loupeClone = document.getElementById('loupe-clone');
        const audioIcon = document.getElementById('audio-icon');

        let lastReadText = ""; // Pour √©viter de r√©p√©ter le m√™me texte en boucle
        let synth = window.speechSynthesis;
        let speechTimeout; // Timer pour √©viter la cacophonie si on bouge trop vite

        // --- 1. INITIALISATION DU CLONE VISUEL ---
        function initLoupe() {
            // Copie exacte du HTML
            loupeClone.innerHTML = siteWrapper.outerHTML;
            loupeClone.setAttribute('aria-hidden', 'true'); // On cache le clone aux lecteurs d'√©cran natifs
            loupeClone.style.transform = `scale(${ZOOM_LEVEL})`;
            
            // Correction largeur clone pour correspondre au viewport
            loupeClone.style.width = document.body.scrollWidth + 'px';
            loupeContainer.style.display = 'block';
        }

        // --- 2. FONCTION PARLER (TTS) ---
        function speak(text) {
            if (!text || text.trim() === "") return;

            // Annuler la lecture pr√©c√©dente pour ne pas superposer les voix
            synth.cancel();

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'fr-FR'; // Forcer le fran√ßais
            utterance.rate = 1; // Vitesse normale
            utterance.pitch = 1;

            // Gestion de l'ic√¥ne visuelle
            utterance.onstart = () => { audioIcon.style.opacity = 1; };
            utterance.onend = () => { audioIcon.style.opacity = 0; };

            synth.speak(utterance);
        }

        // --- 3. BOUCLE PRINCIPALE (MOUVEMENT) ---
        document.addEventListener('mousemove', (e) => {
            const mouseX = e.clientX;
            const mouseY = e.clientY;
            const pageX = e.pageX;
            const pageY = e.pageY;

            // --- A. GESTION VISUELLE (ZOOM) ---
            loupeContainer.style.transform = `translate(${mouseX - LOUPE_SIZE / 2}px, ${mouseY - LOUPE_SIZE / 2}px)`;
            
            const contentX = - (pageX * ZOOM_LEVEL) + (LOUPE_SIZE / 2);
            const contentY = - (pageY * ZOOM_LEVEL) + (LOUPE_SIZE / 2);

            loupeClone.style.left = contentX + "px";
            loupeClone.style.top = contentY + "px";

            // --- B. GESTION AUDIO (DETECTION) ---
            // On regarde quel √©l√©ment est SOUS la souris (sur le site original, pas la loupe)
            // Gr√¢ce √† pointer-events: none sur la loupe, elementFromPoint traverse jusqu'au site.
            let target = document.elementFromPoint(mouseX, mouseY);

            if (target) {
                // On cherche l'√©l√©ment textuel le plus proche (si on survole un <span> ou <strong>, on remonte au <p>)
                let readableElement = target.closest('p, h1, h2, h3, button, a, li');

                if (readableElement) {
                    let text = readableElement.innerText;

                    // Si c'est un nouveau texte qu'on n'a pas encore lu
                    if (text !== lastReadText) {
                        lastReadText = text;
                        
                        // Petit d√©lai (debounce) pour ne pas lire si on traverse l'√©cran √† toute vitesse
                        clearTimeout(speechTimeout);
                        speechTimeout = setTimeout(() => {
                            speak(text);
                        }, 200); // Attend 200ms de "pause" sur l'√©l√©ment avant de lire
                    }
                } else {
                    // Si on est dans le vide, on reset (permet de relire le m√™me texte si on sort et revient)
                    lastReadText = "";
                }
            }
        });

        // Mise √† jour si redimensionnement fen√™tre
        window.addEventListener('resize', () => {
             loupeClone.innerHTML = siteWrapper.outerHTML;
             loupeClone.style.width = document.body.scrollWidth + 'px';
        });

        // Lancement
        initLoupe();

    </script>
</body>
</html>
